<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Snake</title>
</head>
<body onkeydown=v=event.which%4 text=#6c9>
  <style>
    b{color:#000}
    u{color:red}
  </style>
  <pre><center id=o></center></pre>
  <script> // <body onload="
    D=[W=40,-1,-W,1] // 0:down,1:left,2:up,3:right
    L=W*30 // size
    T='000<b>()</b>0Vx0xV0<u>oO</u>0. '.split(a=0) // a:ate
    r=window.localStorage||{}
    r.r|=0 // r.r:topscore
    n='\n'

    setInterval(function(){ // setInterval('

      if(a<6){ // ate something wrong...
        // new game init
        f=[s=1] // f:field s:score
        for(i=L;i--;a=i)f[i]=i^572?i%W&&a%W&&i>W&i<L-W?7:4+i/W%2|0:6
        f[h=t=592]=v=3 // h:head t:tail
      }

      // move head
      a=f[h-=D[m=f[h]]] // move and eat
      f[h]=m&1^v&1?v:m // turn (no-turn-back)

      // move tail
      if(a^6){
        t-=D[f[i=t]]
        f[i]=7
      }else{
        for(++s<r.r?0:r.r=s;f[i=Math.random()*L|0]^7;);
        f[i]=6
      }

      // display
      for(j=n,i=L;i--;i%W?0:j+=n)j+=T[f[i]]||T[3]
      o.innerHTML='LEN:'+s+' TOP:'+r.r+j

    },99)
  </script>
</body>
</html>
